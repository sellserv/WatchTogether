# WatchParty - Self-hosted YouTube Watch Party
# Deploy on Ubuntu VM (Proxmox) with Cloudflare Tunnel
# No port forwarding, no UDP â€” all traffic via tunnel

services:
  server:
    build: ./server
    container_name: watchparty-server
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - PORT=3001
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
    networks:
      - watchparty

  frontend:
    build: ./frontend
    container_name: watchparty-frontend
    restart: unless-stopped
    depends_on:
      - server
    networks:
      - watchparty

  tunnel:
    image: cloudflare/cloudflared:latest
    container_name: watchparty-tunnel
    restart: unless-stopped
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${TUNNEL_TOKEN}
    depends_on:
      - frontend
    networks:
      - watchparty

networks:
  watchparty:
    driver: bridge
